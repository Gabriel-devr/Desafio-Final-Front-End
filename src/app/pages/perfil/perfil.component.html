<div class="background">
    <div class="container fade-in">
        <div class="profile-header mb-4">
            <div class="header-content">
                <div class="avatar-large">RA</div>
                <div>
                    <h2 class="mb-1 fw-bold text-white">{{ usuario.nome }}</h2>
                    <p class="mb-0 text-white-50">{{ usuario.email }}</p>
                </div>
            </div>
            <div class="header-stats">
                <div class="stat-box"><span class="value">{{ mediaDor }}</span><span class="label">Média Dor</span>
                </div>
                <div class="stat-box"><span class="value">{{ diasSeguidos }}</span><span class="label">Registros</span>
                </div>
            </div>
        </div>

        <div class="appointments-section mb-4 fade-in">
            <h5 class="fw-bold mb-3 text-muted d-flex align-items-center gap-2">
                <span class="material-symbols-outlined text-primary">calendar_month</span> Próximos Agendamentos
            </h5>
            <div class="carousel-container">
                <div class="appointment-card add-card" [class.expanded]="exibirFormAgendamento">
                    @if (!exibirFormAgendamento) {
                    <div class="add-content" (click)="alternarFormAgendamento()">
                        <div class="icon-circle"><span class="material-symbols-outlined">add</span></div>
                        <p class="mb-0 fw-bold mt-2">Novo</p>
                    </div>
                    } @else {
                    <div class="form-content">
                        <h6 class="fw-bold mb-2">Novo</h6>
                        <input type="text" class="form-control form-control-sm mb-2" placeholder="Título"
                            [(ngModel)]="novoAgendamento.titulo">
                        <div class="d-flex gap-2 mb-2">
                            <input type="date" class="form-control form-control-sm" [(ngModel)]="novoAgendamento.data">
                            <input type="time" class="form-control form-control-sm"
                                [(ngModel)]="novoAgendamento.horario">
                        </div>
                        <select class="form-select form-select-sm mb-2" [(ngModel)]="novoAgendamento.tipo">
                            <option value="consulta">Consulta</option>
                            <option value="terapia">Terapia</option>
                            <option value="exame">Exame</option>
                        </select>
                        <div class="d-flex gap-2 mt-2">
                            <button class="btn btn-sm btn-light flex-grow-1"
                                (click)="alternarFormAgendamento()">Cancelar</button>
                            <button class="btn btn-sm btn-primary flex-grow-1"
                                (click)="salvarAgendamento()">Salvar</button>
                        </div>
                    </div>
                    }
                </div>

                @for (agenda of listaAgendamentos; track agenda.id) {
                <div class="appointment-card item-card" [style.border-left-color]="getCorAgendamento(agenda.tipo)">
                    <div class="card-top">
                        <span class="badge-type" [style.background-color]="getCorAgendamento(agenda.tipo) + '20'"
                            [style.color]="getCorAgendamento(agenda.tipo)">{{ agenda.tipo }}</span>
                        <span class="material-symbols-outlined icon-menu text-danger"
                            style="cursor: pointer; font-size: 18px;"
                            (click)="deletarAgendamento(agenda.id)">delete</span>
                    </div>
                    <h6 class="fw-bold mb-1 text-truncate">{{ agenda.titulo }}</h6>
                    <p class="text-muted small mb-2 text-truncate">{{ agenda.local }}</p>
                    <div class="card-date">
                        <span class="material-symbols-outlined icon-small">event</span>
                        <span>{{ agenda.data | date:'dd/MM' }}</span>
                    </div>
                </div>
                }
            </div>
        </div>

        <div class="row g-4">
            <div class="col-lg-5">
                <div class="card p-4 h-100">
                    <h5 class="fw-bold mb-4 d-flex align-items-center gap-2"><span
                            class="material-symbols-outlined text-primary">clinical_notes</span> Check-in Diário</h5>
                    <div class="mb-4">
                        <label class="d-flex justify-content-between fw-bold text-muted mb-2">Dor <span
                                [style.color]="getCorDor(novoRegistro.nivelDor)">{{ novoRegistro.nivelDor
                                }}/10</span></label>
                        <input type="range" class="form-range custom-range" min="0" max="10" step="1"
                            [(ngModel)]="novoRegistro.nivelDor">
                    </div>
                    <div class="mb-4">
                        <label class="d-flex justify-content-between fw-bold text-muted mb-2">Fadiga <span>{{
                                novoRegistro.nivelFadiga }}/10</span></label>
                        <input type="range" class="form-range custom-range" min="0" max="10" step="1"
                            [(ngModel)]="novoRegistro.nivelFadiga">
                    </div>
                    <div class="mb-4">
                        <label class="fw-bold text-muted mb-2">Humor</label>
                        <div class="mood-selector">
                            <div class="mood-option" [class.selected]="novoRegistro.humor === 'feliz'"
                                (click)="novoRegistro.humor = 'feliz'"><span
                                    class="material-symbols-outlined">sentiment_very_satisfied</span></div>
                            <div class="mood-option" [class.selected]="novoRegistro.humor === 'neutro'"
                                (click)="novoRegistro.humor = 'neutro'"><span
                                    class="material-symbols-outlined">sentiment_neutral</span></div>
                            <div class="mood-option" [class.selected]="novoRegistro.humor === 'triste'"
                                (click)="novoRegistro.humor = 'triste'"><span
                                    class="material-symbols-outlined">sentiment_dissatisfied</span></div>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="fw-bold text-muted mb-2">Notas</label>
                        <textarea class="form-control bg-light border-0" rows="3"
                            [(ngModel)]="novoRegistro.notas"></textarea>
                    </div>
                    <button class="btn btn-primary w-100 py-2 rounded-pill fw-bold"
                        (click)="salvarRegistro()">Salvar</button>
                </div>
            </div>

            <div class="col-lg-7">
                <div class="card p-4 border-0 bg-transparent shadow-none">
                    <h5 class="fw-bold mb-3 text-muted">Histórico Recente</h5>
                    <div class="history-list">
                        @for (reg of historico; track reg.id) {
                        <div class="history-card">
                            <div class="date-col">
                                <span class="day">{{ reg.data | date:'dd' }}</span>
                                <span class="month">{{ reg.data | date:'MMM' }}</span>
                                <span class="material-symbols-outlined mt-2 mood-icon">{{ getIconeHumor(reg.humor)
                                    }}</span>
                            </div>
                            <div class="content-col">
                                <div class="d-flex justify-content-between">
                                    <div class="stats-badges mb-2">
                                        <span class="badge" [style.background-color]="getCorDor(reg.nivelDor)">Dor: {{
                                            reg.nivelDor }}</span>
                                        <span class="badge bg-secondary">Fadiga: {{ reg.nivelFadiga }}</span>
                                    </div>
                                    <button class="btn btn-link text-danger p-0 border-0"
                                        (click)="deletarHistorico(reg.id)">
                                        <span class="material-symbols-outlined" style="font-size: 18px;">close</span>
                                    </button>
                                </div>
                                <p class="mb-0 text-muted">{{ reg.notas || 'Sem anotações.' }}</p>
                            </div>
                        </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>